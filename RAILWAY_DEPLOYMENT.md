# Развертывание ОНА-бота на Railway

## Подготовка репозитория

1. Убедитесь, что в репозитории есть следующие файлы:
   - `railway.toml` - конфигурация для Railway
   - `Procfile` - инструкции для запуска бота
   - `start.sh` - скрипт запуска бота
   - `railway_requirements.txt` - требования для Railway
   - `supabase_requirements.txt` - требования для Supabase
   - `patch_pydantic.py` - патч для совместимости pydantic и aiogram

2. Убедитесь, что у скриптов есть права на выполнение:
   ```bash
   git update-index --chmod=+x start.sh
   git update-index --chmod=+x install_supabase.sh
   ```

## Настройка проекта на Railway

1. Создайте новый проект на Railway
   - Выберите опцию "Deploy from GitHub"
   - Подключите свой репозиторий GitHub
   - Выберите ветку для развертывания

2. Настройте переменные окружения:
   - `BOT_TOKEN` - токен бота Telegram
   - `OPENAI_API_KEY` - API ключ OpenAI (опционально)
   - `ELEVEN_API_KEY` - API ключ Eleven Labs (опционально)
   - `SUPABASE_URL` - URL Supabase (опционально)
   - `SUPABASE_KEY` - API ключ Supabase (опционально)

3. Начните развертывание
   - Нажмите "Deploy"
   - Дождитесь завершения процесса сборки и развертывания

## Проверка работоспособности

1. Проверьте логи развертывания на наличие ошибок
2. Убедитесь, что бот запущен и отвечает на команды
3. Проверьте, что бот правильно переключается на SQLite при отсутствии Supabase

## Устранение проблем

### Проблема с импортом Supabase
Если в логах есть ошибка `ImportError: No module named 'supabase'`, бот автоматически переключится на SQLite. Это нормальное поведение в среде Railway.

### Проблема с pydantic
Если в логах есть ошибка, связанная с pydantic (например, `ImportError: cannot import name 'model_validator' from 'pydantic'`), проверьте применение патча в `patch_pydantic.py`.

### Ошибка при создании бота
Если бот не запускается с ошибкой создания экземпляра бота, проверьте валидность токена и правильность установки зависимостей.

## Автоматическое обновление

После настройки, любые изменения, внесенные в репозиторий GitHub, будут автоматически развернуты на Railway. 