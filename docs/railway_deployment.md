# Развертывание ONA бота на Railway

Railway - это современная платформа для развертывания приложений с автоматическим CI/CD, которая идеально подходит для размещения Telegram ботов.

## Подготовка к деплою

### 1. Создание аккаунта и проекта

1. Зарегистрируйтесь на [Railway.app](https://railway.app/)
2. Создайте новый проект:
   - Нажмите "New Project"
   - Выберите "Deploy from GitHub repo"
   - Выберите репозиторий с вашим ботом

### 2. Настройка переменных окружения

В Railway необходимо настроить следующие переменные окружения:

1. В интерфейсе проекта перейдите на вкладку "Variables"
2. Добавьте следующие переменные:
   - `BOT_TOKEN` - токен вашего Telegram бота от BotFather
   - `OPENAI_API_KEY` - ключ API OpenAI (если используется)
   - `ELEVEN_TOKEN` - токен Eleven Labs (если используется)
   - Другие необходимые переменные из файла `.env`

## Настройка базы данных PostgreSQL

### 1. Добавление PostgreSQL

1. В интерфейсе проекта нажмите "New"
2. Выберите "Database" → "PostgreSQL"
3. Дождитесь создания базы данных

### 2. Подключение базы данных к проекту

1. Перейдите в созданную базу данных PostgreSQL
2. Выберите вкладку "Connect"
3. Скопируйте строку подключения PostgreSQL (начинается с "postgres://...")
4. Перейдите обратно в проект с ботом, во вкладку "Variables"
5. Добавьте переменную:
   - **Key**: `DATABASE_URL`
   - **Value**: вставьте скопированную строку подключения

## Запуск и мониторинг

### 1. Первый деплой

1. После настройки всех переменных Railway автоматически запустит деплой
2. Вы можете отслеживать прогресс на вкладке "Deployments"

### 2. Проверка работы

1. После успешного деплоя перейдите на вкладку "Logs"
2. Убедитесь, что бот запустился без ошибок
3. Проверьте работу бота, отправив команду `/start` в Telegram

### 3. Настройка автоматического перезапуска

Railway автоматически перезапускает ваше приложение при сбоях, но для дополнительной надежности:

1. В Railway, перейдите в настройки проекта
2. На вкладке "Settings" убедитесь, что опция "Automatic Deploys" включена
3. В "Health Checks" можно настроить автоматическую проверку работоспособности

## Оптимизация затрат

Railway предлагает ограниченные бесплатные ресурсы. Для оптимизации затрат:

1. Используйте минимальное количество ресурсов:
   - На вкладке "Settings" установите подходящие лимиты CPU и RAM
2. Настройте спящий режим для неактивных периодов:
   - В "Settings" включите опцию "Sleep when inactive"

## Обновление бота

1. Внесите изменения в код и отправьте их в GitHub-репозиторий
2. Railway автоматически обнаружит изменения и выполнит новый деплой
3. Убедитесь, что все изменения применены корректно

## Решение проблем

### Ошибки с базой данных

Если возникают проблемы с подключением к PostgreSQL:

1. Проверьте переменную окружения `DATABASE_URL`
2. Запустите скрипт `test_postgres_connection.py` локально с той же переменной окружения
3. Проверьте логи на наличие ошибок при инициализации базы данных

### Ошибки с Telegram API

Если бот не отвечает:

1. Убедитесь, что `BOT_TOKEN` указан правильно
2. Проверьте логи на предмет ошибок от Telegram API
3. Убедитесь, что домен Railway не заблокирован в вашем регионе

## Дополнительные ресурсы

- [Документация Railway](https://docs.railway.app/)
- [Документация PostgreSQL](https://www.postgresql.org/docs/)
- [API Telegram Bot](https://core.telegram.org/bots/api) 