# Настройка PostgreSQL на Railway для ONA бота

В этой инструкции описаны шаги по подключению Telegram бота к базе данных PostgreSQL на платформе Railway.

## Преимущества использования PostgreSQL вместо SQLite

1. **Надежность хранения данных**: в отличие от SQLite, данные PostgreSQL сохраняются между деплоями и перезапусками
2. **Масштабируемость**: PostgreSQL легко справляется с большим количеством одновременных запросов
3. **Резервное копирование**: Railway предоставляет инструменты для автоматического бэкапа базы данных
4. **Расширенные функции**: более продвинутые SQL-функции и типы данных

## Шаги по настройке

### 1. Создание базы данных PostgreSQL

1. Войдите в свой аккаунт Railway
2. На главной странице проекта нажмите кнопку **"New"**
3. Выберите **"Database"** → **"PostgreSQL"**
4. Дождитесь завершения процесса создания (обычно занимает 1-2 минуты)

### 2. Получение строки подключения

1. Перейдите в созданную базу данных PostgreSQL в проекте
2. Выберите вкладку **"Connect"**
3. В разделе "Connection string" скопируйте строку подключения PostgreSQL:
   ```
   postgres://postgres:password@containers-us-west-XXX.railway.app:XXXX/railway
   ```

### 3. Установка переменной окружения

1. Перейдите в ваш проект с ботом на Railway
2. Выберите вкладку **"Variables"**
3. Нажмите кнопку **"New Variable"**
4. Добавьте переменную:
   - **Key**: `DATABASE_URL`
   - **Value**: вставьте скопированную строку подключения
5. Нажмите **"Add"**

### 4. Перезапуск бота

1. После добавления переменной, Railway автоматически начнет процесс деплоя
2. Вы также можете вручную перезапустить бота, нажав кнопку **"Deploy"**
3. После перезапуска бот автоматически определит наличие PostgreSQL и настроит соединение

## Проверка работы

При успешном подключении к PostgreSQL вы увидите следующие сообщения в логах:

```
INFO: Обнаружена переменная DATABASE_URL: PostgreSQL будет использоваться как база данных
INFO: Инициализация PostgreSQL по адресу: postgres://...
INFO: База данных PostgreSQL успешно инициализирована
```

## Резервное копирование данных

1. В Railway перейдите к вашей базе данных PostgreSQL
2. Выберите вкладку **"Backups"**
3. Нажмите кнопку **"Backup Now"** для создания ручного бэкапа
4. Для настройки автоматических бэкапов нажмите **"Enable Auto Backups"**

## Миграция данных с SQLite на PostgreSQL

Если у вас уже есть данные в SQLite, вы можете перенести их в PostgreSQL:

1. Запустите `run_example.py` на локальном компьютере перед настройкой DATABASE_URL
2. Убедитесь, что данные успешно записались в SQLite
3. Настройте DATABASE_URL на Railway
4. Ваше приложение автоматически начнет использовать PostgreSQL, а новые пользователи будут добавляться уже в PostgreSQL

### Важные примечания

- Бот реализует автоматическое определение типа базы данных: PostgreSQL при наличии DATABASE_URL или SQLite в противном случае
- Файл SQLite `data/database.db` остается в репозитории для локальной разработки
- PostgreSQL предпочтительнее для продакшена, SQLite - для локальной разработки
- Не добавляйте чувствительные данные в URL базы данных в коде - всегда используйте переменные окружения 