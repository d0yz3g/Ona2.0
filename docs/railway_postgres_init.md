# Инициализация PostgreSQL базы данных на Railway

Эта инструкция поможет вам настроить базу данных PostgreSQL на Railway и создать необходимые таблицы для работы бота.

## Шаги по инициализации базы данных

### 1. Создание базы данных в Railway

1. В панели управления Railway, нажмите кнопку "New" и выберите "Database" → "PostgreSQL"
2. Дождитесь создания базы данных (обычно занимает несколько секунд)

### 2. Получение строки подключения

1. Перейдите в созданную базу данных PostgreSQL в Railway
2. Выберите вкладку "Connect"
3. Скопируйте строку подключения PostgreSQL (начинается с "postgres://...")

### 3. Настройка переменной окружения в проекте с ботом

1. Перейдите в проект с ботом на Railway
2. Выберите вкладку "Variables"
3. Добавьте переменную с ключом `DATABASE_URL` и значением скопированной строки подключения
4. Нажмите "Add" для сохранения переменной

### 4. Инициализация таблиц в базе данных

> **Новая функция!** Таблицы теперь создаются автоматически при запуске бота!

Бот автоматически проверяет наличие необходимых таблиц при запуске и создает их, если они отсутствуют. Просто перезапустите бот после добавления переменной окружения `DATABASE_URL`.

Если по какой-то причине автоматическая инициализация не сработала, вы можете создать таблицы вручную:

#### Ручная инициализация (только если автоматическая не сработала)

Выполните эту команду на Railway через вкладку "Deployments" → "Shell":

```bash
python init_postgres.py
```

Вы должны увидеть следующие сообщения:
```
INFO - Запуск инициализации базы данных PostgreSQL...
INFO - Найдена переменная DATABASE_URL: postgres://...
INFO - Импортирован модуль db_postgres
INFO - Создан экземпляр Database
INFO - Принудительное создание таблиц в PostgreSQL...
INFO - Таблицы в PostgreSQL успешно созданы!
INFO - Обнаружены таблицы в базе данных: users, answers, profiles, reminders
INFO - Все необходимые таблицы созданы успешно!
INFO - Создание тестового пользователя для проверки...
INFO - Тестовый пользователь создан с ID: 1
INFO - Инициализация базы данных PostgreSQL завершена успешно!
```

### 5. Проверка создания таблиц

1. Вернитесь в базу данных PostgreSQL на Railway
2. Выберите вкладку "Data"
3. Вы должны увидеть созданные таблицы: users, answers, profiles, reminders

## Устранение неполадок

### Если таблицы не создаются автоматически:

1. Проверьте логи бота на наличие ошибок при инициализации PostgreSQL
2. Убедитесь, что переменная окружения `DATABASE_URL` установлена правильно
3. Перезапустите бот через вкладку "Deployments" (кнопка "Restart")
4. Если таблицы все еще не созданы, выполните инициализацию вручную как описано выше

### Если вы видите ошибку SSL:

Добавьте к строке подключения параметр `?sslmode=require`:
```
postgres://username:password@hostname:port/database_name?sslmode=require
```

## Дополнительная информация

- База данных PostgreSQL на Railway имеет ограничение на количество соединений
- Используйте пул соединений, если планируете масштабировать бота
- Периодически делайте резервные копии базы данных через вкладку "Backups" в Railway или с помощью скрипта `backup_postgres.py` 