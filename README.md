# Она — Телеграм-бот для психологического профилирования

Бот "Она" — это персональный помощник для психологического профилирования, рекомендаций и медитаций. Он поможет пользователям узнать свои сильные стороны, получать психологические советы и выполнять практики для улучшения самочувствия.

## Основные функции

- **Психологическое профилирование**: Бот проводит опрос из 34 вопросов и формирует психологический профиль пользователя
- **Персональные рекомендации**: AI-рекомендации для личностного роста на основе профиля пользователя
- **Аудио-медитации**: Голосовые медитации разных типов с использованием TTS API
- **Регулярные напоминания**: Ежедневные напоминания о практиках

## Команды бота

- `/start` — Начать взаимодействие с ботом
- `/help` — Показать список доступных команд
- `/profile` — Просмотреть свой психологический профиль
- `/questionnaire`, `/begin` — Начать опрос для создания профиля
- `/reflect` — Получить психологический совет
- `/meditate` — Получить голосовую медитацию (доступны варианты: relax, focus, sleep)
- `/reminder_on` — Включить ежедневные напоминания
- `/reminder_off` — Отключить напоминания
- `/reminder_status` — Проверить статус напоминаний

## Технический стек

- **Язык:** Python 3.11+
- **Framework:** aiogram 3.x
- **База данных:** SQLite
- **AI-интеграции:** OpenAI API
- **Голосовой синтез:** ElevenLabs TTS API
- **Планировщик:** APScheduler
- **Контейнеризация:** Docker

## Структура проекта

```
ona_bot/
├── main.py              # Точка входа в приложение
├── db.py                # Работа с базой данных
├── handlers.py          # Основные обработчики команд и опроса
├── handlers/            # Модульные обработчики
│   ├── __init__.py
│   ├── recs.py          # Обработчики рекомендаций
│   ├── meditate.py      # Обработчики медитаций
│   ├── reminders.py     # Обработчики напоминаний
├── services/            # Сервисные модули
│   ├── __init__.py
│   ├── ai_client.py     # Клиент для OpenAI API
│   ├── astrology.py     # Астрологические расчеты
│   ├── recs.py          # Генерация рекомендаций
│   ├── tts.py           # Генерация голоса через ElevenLabs
│   ├── scheduler.py     # Планировщик напоминаний
├── tmp/                 # Временные файлы
├── tests/               # Тесты
├── docs/                # Документация
├── .env                 # Переменные окружения (не включено в репозиторий)
├── .env.example         # Пример переменных окружения
├── requirements.txt     # Зависимости проекта
├── Dockerfile           # Для сборки контейнера
└── .dockerignore        # Исключения для Docker
```

## Локальная разработка

### Подготовка

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/ваш-репозиторий/ona-bot.git
   cd ona-bot
   ```

2. Создать виртуальное окружение и установить зависимости:
   ```bash
   python -m venv venv
   source venv/bin/activate  # или venv\Scripts\activate в Windows
   pip install -r requirements.txt
   ```

3. Создать файл `.env` на основе `.env.example` и заполнить необходимые переменные:
   ```
   BOT_TOKEN=ваш_токен_бота
   OPENAI_API_KEY=ваш_ключ_openai
   ELEVEN_API_KEY=ваш_ключ_elevenlabs
   ELEVEN_VOICE_ID=21m00Tcm4TlvDq8ikWAM
   ```

4. Запустить бота:
   ```bash
   python main.py
   ```

### Переменные окружения

| Переменная      | Описание                                       | Пример                                 |
|-----------------|------------------------------------------------|----------------------------------------|
| BOT_TOKEN       | Токен Telegram бота от @BotFather              | 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ |
| OPENAI_API_KEY  | Ключ API OpenAI для генерации рекомендаций     | sk-ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh |
| ELEVEN_API_KEY  | Ключ API ElevenLabs для генерации голоса       | abcdefghijklmnopqrstuvwxyz123456      |
| ELEVEN_VOICE_ID | ID голоса в ElevenLabs (женский по умолчанию)  | 21m00Tcm4TlvDq8ikWAM                   |
| PORT            | Порт для healthcheck (опционально)             | 8080                                   |

## Деплой на Railway

1. Создайте аккаунт на [Railway](https://railway.app/)

2. Подключите репозиторий:
   - Перейдите в раздел "New Project" → "Deploy from GitHub"
   - Выберите репозиторий с ботом
   - Railway автоматически определит наличие Dockerfile

3. Добавьте переменные окружения:
   - В разделе "Variables" добавьте все необходимые переменные из `.env.example`

4. Настройте healthcheck:
   - В разделе "Settings" → "Health Check" укажите URL: `/health`
   - Команда: `curl -f http://localhost:8080/health || exit 1`

5. Запустите деплой

## Мониторинг и тестирование

- Проверьте логи в разделе "Logs" на Railway
- Используйте чеклист для E2E тестирования в `tests/e2e_checklist.md`
- Для локальной проверки healthcheck: `curl http://localhost:8080/health`

## Лицензия

Проект распространяется под MIT лицензией. См. файл LICENSE для подробностей. 